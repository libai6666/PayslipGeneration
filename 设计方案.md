# 工资条生成器 - 设计方案文档

## 1. 项目概述

本项目是一个用于生成工资条的桌面应用程序，使用Python 3.9.10实现。用户可以通过图形界面输入员工信息，系统会自动计算缺勤扣款和实发工资，并生成Excel格式的工资条文件。支持单人模式和批量模式两种工作方式。

## 2. 功能需求分析

根据需求文档，系统需要实现以下功能：

1. 提供图形化用户界面，包含以下输入字段：
   - 姓名
   - 基本工资
   - 应出勤天数
   - 实际出勤天数
   - 夜班补助
   - 高温补贴
   - 迟到罚款
   - 其他

2. 自动计算以下字段：
   - 缺勤扣款：(基本工资 / 应出勤天数) * (应出勤天数 - 实际出勤天数)，为负值
   - 实发工资：基本工资 + 缺勤扣款 + 夜班补助 + 高温补贴 + 迟到罚款 + 其他

3. 生成Excel格式的工资条，包含所有输入字段和计算字段

4. 支持批量输入员工信息和批量生成工资条

5. 支持从Excel或CSV文件导入员工数据

6. 打包为Windows可执行文件(.exe)，方便直接运行

## 3. 技术方案选择

### 3.1 主要技术栈

- **编程语言**：Python 3.9.10
- **GUI框架**：PyQt5，提供现代化、美观的用户界面
- **Excel处理库**：openpyxl，用于生成Excel格式工资条
- **数据处理库**：pandas，用于处理导入的Excel和CSV数据
- **打包工具**：PyInstaller，将Python应用打包为独立的Windows可执行文件

### 3.2 技术选择理由

1. **为什么选择PyQt5而非其他GUI框架**：
   - 相比Tkinter，PyQt5提供更现代化的外观和更强大的功能
   - 相比wxPython，PyQt5的文档更为丰富，社区支持更广泛
   - PyQt5具有完整的表单验证功能，适合本项目的数据输入需求
   - PyQt5的QTableWidget组件非常适合批量数据录入和展示

2. **为什么选择openpyxl而非其他Excel库**：
   - 相比xlsxwriter，openpyxl支持读写Excel文件，功能更全面
   - 相比pandas导出Excel，openpyxl提供更细粒度的样式控制
   - openpyxl对Excel文件格式的支持更为丰富，包括单元格样式、边框、字体等

3. **为什么选择pandas处理导入数据**：
   - pandas提供强大的数据处理功能，可以轻松处理Excel和CSV文件
   - 提供灵活的数据清洗和转换功能，适合处理不同格式的导入数据

4. **为什么选择PyInstaller打包应用**：
   - 相比cx_Freeze，PyInstaller配置更简单，更容易使用
   - 相比py2exe，PyInstaller支持更多的Python版本和库
   - PyInstaller可以将所有依赖打包到单个可执行文件中，方便分发

## 4. 系统架构设计

### 4.1 模块划分

项目分为以下几个主要模块：

1. **UI模块**（ui/payslip_ui.py, ui/batch_payslip_ui.py）：
   - 实现图形用户界面
   - 处理用户交互
   - 调用其他模块进行数据处理和文件生成

2. **核心计算模块**（core/calculator.py）：
   - 实现缺勤扣款和实发工资的计算逻辑
   - 提供输入验证功能

3. **Excel处理模块**（utils/excel.py）：
   - 生成Excel格式的工资条
   - 设置Excel文件样式
   - 保存Excel文件

4. **数据导入模块**（utils/data_import.py）：
   - 实现从Excel和CSV文件导入员工数据
   - 提供数据验证和转换功能
   - 导出导入模板

5. **主程序入口**（main.py）：
   - 应用程序入口点
   - 处理异常情况
   - 初始化UI

### 4.2 数据流程

1. **单人模式数据流程**：
   - 用户在UI界面输入员工信息
   - 点击"生成工资条"按钮
   - 系统验证输入数据有效性
   - 调用计算模块计算缺勤扣款和实发工资
   - 调用Excel处理模块生成工资条Excel文件
   - 保存文件并显示成功消息

2. **批量模式数据流程**：
   - 用户通过UI界面手动输入多名员工信息，或从文件导入数据
   - 点击"批量生成工资条"按钮
   - 系统验证所有员工数据的有效性
   - 调用计算模块为每名员工计算缺勤扣款和实发工资
   - 调用Excel处理模块为每名员工生成工资条Excel文件
   - 保存文件并显示成功消息

## 5. 详细设计

### 5.1 UI设计

#### 5.1.1 单人模式界面（PayslipGeneratorWindow类）

- 标题：工资条生成器
- 输入字段：姓名、基本工资、应出勤天数、实际出勤天数、夜班补助、高温补贴、迟到罚款、其他
- 按钮：生成工资条、清除所有、切换到批量模式
- 输入验证：确保必填字段有值，数字字段只能输入数字

#### 5.1.2 批量模式界面（BatchPayslipWindow类）

- 标题：工资条批量生成器
- 工具栏：导入数据、导出模板、添加员工、删除所选、切换到单人模式
- 表格视图：展示多名员工的数据，可编辑
- 按钮：批量生成工资条、清除所有数据
- 表格验证：确保必填字段有值，数字字段只能输入数字

### 5.2 核心计算模块设计

- **calculate_absence_deduction函数**：
  - 参数：基本工资、应出勤天数、实际出勤天数
  - 返回值：缺勤扣款金额（负值）
  - 逻辑：如果实际出勤大于等于应出勤，返回0；否则计算扣款

- **calculate_net_salary函数**：
  - 参数：基本工资、缺勤扣款、夜班补助、高温补贴、迟到罚款、其他
  - 返回值：实发工资金额
  - 逻辑：将所有参数相加得到实发工资

- **validate_input函数**：
  - 参数：输入文本、默认值
  - 返回值：转换后的数值，或默认值（如果转换失败）
  - 逻辑：尝试将输入转换为数值，如果失败则返回默认值

### 5.3 Excel处理模块设计

- **generate_excel函数**：
  - 参数：员工数据字典、输出文件路径
  - 返回值：生成的Excel文件路径
  - 逻辑：创建Excel工作簿，设置样式，添加数据，保存文件

- **batch_generate_excel函数**：
  - 参数：员工数据字典列表、输出目录
  - 返回值：生成的Excel文件路径列表
  - 逻辑：遍历员工列表，为每个员工调用generate_excel函数

- **set_cell_style函数**：
  - 参数：单元格对象、样式类型
  - 返回值：无
  - 逻辑：根据样式类型为单元格设置样式

### 5.4 数据导入模块设计

- **import_employee_data函数**：
  - 参数：导入文件路径
  - 返回值：员工数据字典列表
  - 逻辑：读取Excel或CSV文件，解析数据，转换为标准格式

- **export_template函数**：
  - 参数：导出文件路径
  - 返回值：无
  - 逻辑：创建标准导入模板Excel文件，添加表头和示例数据

## 6. 实现细节

### 6.1 文件结构

```
PayslipGeneration/
├── main.py                # 主程序入口
├── requirements.txt       # 依赖包列表
├── README.md              # 项目说明文档
├── 设计方案.md            # 设计文档
├── build.bat              # 打包脚本
├── run.bat                # 运行脚本
├── core/
│   ├── __init__.py
│   └── calculator.py      # 计算模块
├── utils/
│   ├── __init__.py
│   ├── excel.py           # Excel处理模块
│   └── data_import.py     # 数据导入模块
├── ui/
│   ├── __init__.py
│   ├── payslip_ui.py      # 单人模式UI
│   └── batch_payslip_ui.py# 批量模式UI
└── assets/                # 资源文件目录
```

### 6.2 依赖包

- PyQt5==5.15.7：UI界面
- openpyxl==3.0.10：Excel文件处理
- pandas==1.4.2：数据处理
- PyInstaller==5.7.0：打包工具

## 7. 部署与运行

### 7.1 安装依赖

```bash
pip install -r requirements.txt
```

### 7.2 运行应用程序

```bash
# 单人模式
python main.py

# 批量模式
python main.py --batch
```

### 7.3 打包为可执行文件

```bash
# 使用打包脚本
build.bat

# 或者直接使用PyInstaller命令
pyinstaller --onefile --windowed --name 工资条生成器 main.py
```

## 8. 测试计划

### 8.1 单元测试

- 测试计算函数是否正确计算缺勤扣款和实发工资
- 测试输入验证函数是否正确处理各种输入情况

### 8.2 功能测试

- 测试单人模式下的工资条生成功能
- 测试批量模式下的工资条生成功能
- 测试从文件导入员工数据功能
- 测试导出模板功能

### 8.3 界面测试

- 测试界面布局是否正常显示
- 测试输入字段验证是否生效
- 测试按钮点击响应是否正常

### 8.4 兼容性测试

- 测试在不同Windows版本上的运行情况
- 测试在不同屏幕分辨率下的显示效果

## 9. 未来扩展

- 添加员工数据保存和加载功能
- 添加批量打印功能
- 添加更多工资项目计算规则
- 添加数据统计和报表功能
- 添加用户权限管理